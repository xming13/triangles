(function(e){function t(t){r.call(this);n.call(this);s.call(this);if(t){t.call(e(this))}}function n(){var t=[];var n=this.data("triangles");var r=n.settings;var s=n.randomColorsArray;var o=e(this).svg("get");o.clear();e(this).css("backgroundColor",r.baseColor);var u=1;if(r.triangleLength>0){r.cols=Math.ceil(r.width/r.triangleLength);r.rows=Math.ceil(r.height/r.triangleLength);u=r.triangleLength}else{var a=r.width/r.cols;var f=r.height/r.rows;u=Math.floor(Math.min(a,f))}o.width(r.width);this.width(r.width).height(r.height);if(r.image){v.call(this,r.image,i);return}for(var l=0;l<r.cols;l++){t.push([]);t[l].push(new Array(r.rows));var d=o.group();for(var m=0;m<r.rows;m++){var g=r.paintColor;if(r.borderColor&&(m==0||l==0||l==r.cols-1||m==r.rows-1)){g=r.borderColor}else if(r.gradient){var y,b,w,E,S,x,T,N,C;if(r.gradient.top){y=c(r.gradient.top);b=c(r.gradient.bottom);if(r.borderColor){S=(m-1)/(r.rows-2)}else{S=m/r.rows}}else if(r.gradient.left){y=c(r.gradient.left);b=c(r.gradient.right);if(r.borderColor){S=(l-1)/r.cols}else{S=l/r.cols}}else if(r.gradient.topLeft){y=c(r.gradient.topLeft);b=c(r.gradient.bottomRight);if(r.borderColor){S=(l+m-2)/(r.cols+r.rows-2)}else{S=(l+m)/(r.cols+r.rows)}}w=h(y[0],y[1],y[2]);E=h(b[0],b[1],b[2]);x=(1-S)*w[0]+S*E[0];T=(1-S)*w[1]+S*E[1];N=(1-S)*w[2]+S*E[2];C=p(x,T,N);g="rgb("+Math.round(C[0])+","+Math.round(C[1])+","+Math.round(C[2])+")"}else if(r.random){var k=Math.random()*s[s.length-1]["value"];for(var L=0;L<s.length;L++){if(s[L]["value"]>=k){g=s[L]["key"];break}}}var A=l*u;var O=m*u;var M=[[A,O],[A+u,O],[A+u,O+u]];t[l][m]=o.polygon(d,M,{fill:g,"class":"paint",opacity:r.initialOpacity})}}n.matrix=t}function r(){var t=this.data("triangles");var n=t.settings;var r=[];if(n.randomColors){r=d(n.randomColors);Object.keys(r).sort(function(e,t){return r[e]-r[t]});var i=0;e.each(r,function(e,t){i+=t["value"];t["value"]=i});t.randomColorsArray=r}}function i(e,t,n){var r=this.data("triangles");var i=r.matrix=[];var s=r.settings;var o=this.svg("get");o.clear();s.width=t;s.height=n;if(s.triangleLength>0){s.cols=Math.ceil(s.width/s.triangleLength);s.rows=Math.ceil(s.height/s.triangleLength)}else{s.cols=Math.ceil(s.width/s.minTriangleLength);s.rows=Math.ceil(s.height/s.minTriangleLength);while(Math.floor(s.width/s.cols)<s.minTriangleLength){s.cols--}while(Math.floor(s.height/s.rows)<s.minTriangleLength){s.rows--}}var u=Math.floor(s.width/s.cols);var a=Math.floor(s.height/s.rows);var f=Math.min(u,a);this.width(s.width).height(s.height);for(var l=0;l<s.cols;l++){i.push([]);i[l].push(new Array(s.rows));var c=o.group();for(var h=0;h<s.rows;h++){var p=Math.floor((l+.5)*u);var d=Math.floor((h+.5)*a);var v=(p+d*s.width)*4;var m="rgba("+[e.data[v++],e.data[v++],e.data[v++],e.data[v++]].join(",")+")";var g=l*f;var y=h*f;var b=[[g,y],[g+f,y],[g+f,y+f]];i[l][h]=o.polygon(c,b,{fill:m,"class":"paint",opacity:s.initialOpacity})}}return this}function s(){var t=this.data("triangles").settings;e("polygon.paint",this.svg("get").root()).on({click:t.onClick,mouseenter:t.onMouseEnter,mouseleave:t.onMouseLeave})}function o(t,n,r){if(typeof n==="undefined"){n=0}switch(t){case"horizontal":u.call(this,n,r);break;case"vertical":a.call(this,n,r);break;case"all":f.call(this,n,r);break;case"diagonal":default:l.call(this,n,r)}return e(this)}function u(t,n){var r=this;var i=r.matrix;var s=r.settings;(function o(u){if(!i[u]||!i[u][0]){return}for(var a=0;a<s.rows;a++){(function(f){e(i[u][f]).fadeTo(1,t,function(){if(f==s.rows-1){if(u==s.cols-1){if(n){n.call(r)}else{if(t==0&&s.fadeOutHorizontalCallback){s.fadeOutHorizontalCallback.call(r)}else if(t==1&&s.fadeInHorizontalCallback){s.fadeInHorizontalCallback.call(r)}}}else{o(u+1)}}})})(a)}})(0)}function a(t,n){var r=this;var i=r.matrix;var s=r.settings;(function o(u){if(u>=s.rows){return}for(var a=0;a<s.cols;a++){(function(f){e(i[f][u]).fadeTo(1,t,function(){if(f==s.cols-1){if(u==s.rows-1){if(n){n.call(r)}else{if(t==0&&s.fadeOutVerticalCallback){s.fadeOutVerticalCallback.call(r)}else if(t==1&&s.fadeInVerticalCallback){s.fadeInVerticalCallback.call(r)}}}else{o(u+1)}}})})(a)}})(0)}function f(t,n){var r=this;var i=r.matrix;var s=r.settings;(function(){e(i[0][0]).parent().parent().fadeTo(500,t,function(){if(n){n.call(r)}else{if(t==0){s.fadeOutAllCallback.call(r)}else if(t==1){s.fadeInAllCallback.call(r)}}})})()}function l(t,n){var r=this;var i=r.matrix;var s=r.settings;(function o(u,a){if(!i[u]||!i[u][a]){return}e(i[u][a]).fadeTo(1,t,function(){if(u==s.cols-1&&a==s.rows-1){if(n){n.call(r)}else{if(t==0&&s.fadeOutDiagonalCallback){s.fadeOutDiagonalCallback.call(r)}else if(t==1&&s.fadeInDiagonalCallback){s.fadeInDiagonalCallback.call(r)}}}else{o(u,a+1);if(a===0){o(u+1,a)}}})})(0,0)}function c(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(/[^0-9A-F]/gi,"").replace(t,function(e,t,n,r){return t+t+n+n+r+r});var n=parseInt(e,16);var r=n>>16&255;var i=n>>8&255;var s=n&255;return[r,i,s]}function h(e,t,n){e=e/255,t=t/255,n=n/255;var r=Math.max(e,t,n),i=Math.min(e,t,n);var s,o,u=r;var a=r-i;o=r==0?0:a/r;if(r==i){s=0}else{switch(r){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4;break}s/=6}return[s,o,u]}function p(e,t,n){var r,i,s;var o=Math.floor(e*6);var u=e*6-o;var a=n*(1-t);var f=n*(1-u*t);var l=n*(1-(1-u)*t);switch(o%6){case 0:r=n,i=l,s=a;break;case 1:r=f,i=n,s=a;break;case 2:r=a,i=n,s=l;break;case 3:r=a,i=f,s=n;break;case 4:r=l,i=a,s=n;break;case 5:r=n,i=a,s=f;break}return[r*255,i*255,s*255]}function d(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push({key:n,value:e[n]})}}t.sort(function(e,t){return e.value-t.value});return t}function v(e,t){var n=this;if(e!==undefined&&e!==null){var r,i,s;r=document.createElement("canvas");i=r.getContext("2d");s=new Image;s.addEventListener("load",function(){r.width=s.width;r.height=s.height;i.drawImage(s,0,0,r.width,r.height);t.call(n,i.getImageData(0,0,r.width,r.height),s.width,s.height)},false);if(e.toLowerCase().indexOf("http://")==0||e.toLowerCase().indexOf("https://")==0||e.indexOf("//")==0){var o=new XMLHttpRequest;o.open("GET","//cors-anywhere.herokuapp.com/"+e);o.responseType="blob";o.onload=function(){var e=o.response;var t=new FileReader;t.onloadend=function(){var e=t.result;s.src=e};t.readAsDataURL(e)};o.onerror=function(){console.log("A network error occurred when sending XMLHttpRequest")};o.send()}else{s.src=e}}}e.fn.triangles=function(n,r){var i=e.extend({},e.fn.triangles.defaults,n);e(this).each(function(){e(this).svg();e(this).data("triangles",{settings:i,fadeTriangles:o});t.call(e(this),r)});return e(this)};e.fn.triangles.defaults={width:200,height:200,cols:20,rows:20,triangleLength:-1,minTriangleLength:5,initialOpacity:1,updateOnResize:true,borderColor:"",baseColor:"#fff",paintColor:"#999",gradient:null,random:false,randomColors:{"#FFA666":.1,"#72A4AF":.3,"#CCC":.6},onClick:function(){},onMouseEnter:function(){},onMouseLeave:function(){},fadeInHorizontalCallback:function(){},fadeInVerticalCallback:function(){},fadeInDiagonalCallback:function(){},fadeInAllCallback:function(){},fadeOutHorizontalCallback:function(){o.call(this,"horizontal",1)},fadeOutVerticalCallback:function(){o.call(this,"vertical",1)},fadeOutDiagonalCallback:function(){o.call(this,"diagonal",1)},fadeOutAllCallback:function(){o.call(this,"all",1)}}})(jQuery)